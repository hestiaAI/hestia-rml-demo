(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1170:function(e,t,r){"use strict";r.r(t);var n=r(1151),o=r(1142),c=r(1483),l=r(412),d=r(1149),f=(r(43),r(96),{props:{paymentURL:{type:String,required:!0},timeout:{type:Number,default:5e3}},data:function(){return{dialog:!0}},mounted:function(){var e=this;setTimeout((function(){window.location.href=e.paymentURL}),this.timeout)}}),v=r(50),component=Object(v.a)(f,(function(){var e=this,t=e._self._c;return t(c.a,{attrs:{transition:"dialog-bottom-transition","max-width":"600",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(n.a,[t(o.c,{staticClass:"text-center pa-6"},[t(l.a,{staticClass:"mb-3",attrs:{color:"success",size:"100"}},[e._v("\n        $vuetify.icons.mdiCheckCircleOutline\n      ")]),e._v(" "),t("div",{staticClass:"mb-3"},[t("span",{staticClass:"text-h6 font-weight-bold"},[e._v("\n          Votre archive a bien été envoyée!\n        ")])]),e._v(" "),t("span",[e._v("\n        Vous allez être redirigé vers la page de paiement.\n      ")]),e._v(" "),t("div",{staticClass:"ma-3"},[t(d.a,{attrs:{color:"success",indeterminate:"",rounded:"",height:"6"}})],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports},1188:function(e,t,r){"use strict";r.r(t);var n=r(1140),o=r(1151),c=r(1505),l=r(1504),d=r(1149),f=(r(11),r(9),r(12),r(15),r(16),r(18)),v=r(23),m=r(1),h=(r(90),r(340),r(34),r(108),r(4),r(10),r(224),r(70),r(47),r(44),r(454),r(31),r(87)),y=r(1194),x=r.n(y),w=r(229),k=r(324),_=r(1187),O=r.n(_),U=r(1170);r(28),r(89);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function L(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(m.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var R={name:"FileUploader",components:{CheckoutDialog:U.default},props:{platform:{type:String,required:!0},country:{type:String,required:!0}},data:function(){return{file:null,progress:!1,uploadPercentage:0,disabled:!1,validated:!1,error:!1,errorMessage:"",success:!1,status:"",successMessage:"Votre archive a bien été envoyée. Nous vous contacterons dès que possible.",fileRules:[function(e){return!!e||"Fichier requis"},function(e){return e&&e.size<5e8||"Le fichier est trop volumineux"},function(e){return e&&e.name.endsWith(".zip")||"Le fichier doit être un zip"}],paymentURL:null,fileType:null,paymentLink:null}},computed:L({},Object(h.c)({encryptionPK:function(e){return e.uploads.encryptionPK},serverlessUrl:function(e){return e.uploads.serverlessUrl},products:function(e){return e.uploads.products}})),watch:{file:function(){this.validated=!1,this.error=!1,this.progress=!1,this.success=!1,this.paymentURL=null,this.paymentLink=null}},methods:{getUberInfos:function(e){var t=this;return Object(v.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t.products[t.country][t.platform].find((function(e){return e.name===t.fileType}))){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,e.file(O.a.makeRe(n.driverInfos.file))[0].async("text");case 5:return o=r.sent,r.next=8,k.a(o,(function(e){var t={};return Object.entries(n.driverInfos.fields).forEach((function(r){var n=Object(f.a)(r,2),o=n[0],c=n[1];t[o]=e[c]})),t}))[0];case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}),r)})))()},getFileType:function(e){var t=this;return this.products[this.country][this.platform].some((function(r){return!!function(e,t){return 0===t.filter((function(t){var r=O.a.makeRe(t);return!e.file(r).length})).length}(e,r.filesNeeded)&&(t.fileType=r.name,t.paymentLink=r.paymentLink,!0)}))},uploadFile:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,content,d,f,v,m,text,h,y,k,_,O,U,j,R,P;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.fileForm.validate()){t.next=2;break}return t.abrupt("return");case 2:return e.disabled=!0,e.error=!1,e.progress=!0,e.status="Reading file...",r=new x.a,t.next=9,r.loadAsync(e.file);case 9:if(n=t.sent,e.status="Validating file...",e.error=!e.getFileType(n),!e.error){t.next=17;break}return e.errorMessage='Erreur pendant la validation du fichier: votre archive n\'est pas reconnu par notre système. Si vous rencontrez des problèmes pour récupérer vos données ou si ce message apparait alors que vous avez récemment récupéré vos données en suivant bien le protocole indiqué sur <a href="https://personaldata.io/nos-donnees-nos-projets/mobilite/uber/rgpd/" target="blank">cette page</a>, veuillez nous contacter via <a :href="whatsAppLink" target="blank">Whatsapp</a>',e.disabled=!1,e.progress=!1,t.abrupt("return");case 17:return e.status="Getting file name...",t.next=20,Object(w.hashFile)(e.file);case 20:return o=t.sent,c="Uber_".concat(o,".zip"),e.status="Encrypting file...",l=null,t.prev=24,t.next=27,n.generateAsync({type:"uint8array"});case 27:return content=t.sent,t.next=30,Object(w.encryptFile)(content,e.encryptionPK);case 30:d=t.sent,l=new File([d],c,{type:"application/zip"}),t.next=42;break;case 34:return t.prev=34,t.t0=t.catch(24),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant l'encryption du fichier: "+t.t0.toString(),t.abrupt("return");case 42:return e.status="Getting presigned URL...",f=null,t.prev=44,v=e.serverlessUrl+"getUploadUrl?"+new URLSearchParams({platform:e.platform,country:e.country,name:c}),t.next=48,fetch(v);case 48:if(200===(m=t.sent).status){t.next=54;break}return t.next=52,m.text();case 52:throw text=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(m.status," : ").concat(text));case 54:return t.next=56,m.json();case 56:if(h=t.sent,f=h.presignedUrl){t.next=60;break}throw new Error("No presigned URL returned");case 60:t.next=70;break;case 62:return t.prev=62,t.t1=t.catch(44),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant la récupération du lien d'upload: "+t.t1.toString(),t.abrupt("return");case 70:return e.status="Uploading file...",t.prev=71,t.next=74,e.$axios.put(f,l,{headers:{"Content-Type":"application/zip"},onUploadProgress:function(t){var progress=Math.round(100*t.loaded/t.total);progress<100&&(e.uploadPercentage=progress)}});case 74:if(200===(y=t.sent).status){t.next=80;break}return t.next=78,y.text();case 78:throw k=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(y.status," : ").concat(k));case 80:t.next=90;break;case 82:return t.prev=82,t.t2=t.catch(71),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant l'upload du fichier: "+t.t2.toString(),t.abrupt("return");case 90:return e.status="Creating a transaction...",t.next=93,e.getUberInfos(n);case 93:return _=t.sent,O=null,t.prev=95,U=e.serverlessUrl+"createTransaction?"+new URLSearchParams(L({filename:c},_)),t.next=99,fetch(U);case 99:if(200===(j=t.sent).status){t.next=105;break}return t.next=103,j.text();case 103:throw R=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(j.status," : ").concat(R));case 105:return t.next=107,j.json();case 107:if(P=t.sent,O=P.client_reference_id){t.next=111;break}throw new Error("No clientRefID returned");case 111:t.next=121;break;case 113:return t.prev=113,t.t3=t.catch(95),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant la création de la transaction: "+t.t3.toString(),t.abrupt("return");case 121:e.paymentURL="".concat(e.paymentLink,"?prefilled_email=").concat(_.email,"&client_reference_id=").concat(O,"&locale=fr"),e.status="",e.success=!0,e.disabled=!1,e.progress=!1;case 126:case"end":return t.stop()}}),t,null,[[24,34],[44,62],[71,82],[95,113]])})))()}}},P=r(50),component=Object(P.a)(R,(function(){var e=this,t=e._self._c;return t(o.a,{staticClass:"pa-6",attrs:{outlined:""}},[t(l.a,{ref:"fileForm"},[t(c.a,{staticClass:"mx-auto",attrs:{disabled:e.disabled,rules:e.fileRules,"show-size":"",label:"Sélectionnez votre archive",accept:"application/zip"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e._v(" "),t("BaseButton",e._b({staticClass:"my-sm-2 mr-sm-4",attrs:{"mdi-icon":"mdiUpload",color:"primary"},on:{click:e.uploadFile}},"BaseButton",{error:e.error,success:e.success,disabled:e.disabled,progress:e.progress},!1),[t("span",[e._v("Transmettez vos données")])]),e._v(" "),e.status?t("div",{domProps:{textContent:e._s(e.status)}}):e._e(),e._v(" "),e.error||e.success?t(n.a,{staticClass:"mt-6 text-left",attrs:{type:e.error?"error":"success",text:""}},[t("div",{domProps:{innerHTML:e._s(e.error?e.errorMessage:e.successMessage)}})]):e._e(),e._v(" "),e.success&&e.paymentURL?t("CheckoutDialog",e._b({},"CheckoutDialog",{paymentURL:e.paymentURL},!1)):e._e()],1),e._v(" "),e.progress&&e.uploadPercentage?t("div",{staticClass:"text-center mt-6"},[t(d.a,{attrs:{value:e.uploadPercentage,color:"primary",height:"4"}}),e._v(" "),t("div",[e._v(e._s(e.uploadPercentage)+"%")])],1):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{BaseButton:r(620).default,CheckoutDialog:r(1170).default})}}]);