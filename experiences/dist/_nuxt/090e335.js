(window.webpackJsonp=window.webpackJsonp||[]).push([[14,13],{1167:function(e,t,r){"use strict";r.r(t);var n=r(1149),o=r(1140),c=r(1483),l=r(412),d=r(1148),f=(r(43),r(96),{props:{paymentURL:{type:String,required:!0},timeout:{type:Number,default:5e3}},data:function(){return{dialog:!0}},mounted:function(){var e=this;setTimeout((function(){window.location.href=e.paymentURL}),this.timeout)}}),v=r(50),component=Object(v.a)(f,(function(){var e=this,t=e._self._c;return t(c.a,{attrs:{transition:"dialog-bottom-transition","max-width":"600",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(n.a,[t(o.c,{staticClass:"text-center pa-6"},[t(l.a,{staticClass:"mb-3",attrs:{color:"success",size:"100"}},[e._v("\n        $vuetify.icons.mdiCheckCircleOutline\n      ")]),e._v(" "),t("div",{staticClass:"mb-3"},[t("span",{staticClass:"text-h6 font-weight-bold"},[e._v("\n          Votre archive a bien été envoyée!\n        ")])]),e._v(" "),t("span",[e._v("\n        Vous allez être redirigé vers la page de paiement.\n      ")]),e._v(" "),t("div",{staticClass:"ma-3"},[t(d.a,{attrs:{color:"success",indeterminate:"",rounded:"",height:"6"}})],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports},1181:function(e,t,r){"use strict";r.r(t);var n=r(1138),o=r(1149),c=r(1486),l=r(1482),d=r(1148),f=r(23),v=(r(90),r(340),r(34),r(12),r(4),r(70),r(47),r(44),r(453),r(31),r(1186)),m=r.n(v),h=r(1230),_=r.n(h),x=r(228),y=r(323),w={name:"FileUploader",components:{CheckoutDialog:r(1167).default},props:{s3URL:{type:String,default:"https://serverless.hestia.ai/.netlify/functions/"},publicKey:{type:String,default:"fa71a63fafb8f9f3f5f23e120976c81995ee711a3d73ee871e82102bedf41022"},platform:{type:String,required:!0},country:{type:String,required:!0}},data:function(){return{file:null,progress:!1,uploadPercentage:0,disabled:!1,validated:!1,error:!1,errorMessage:"",success:!1,status:"",successMessage:"Votre archive a bien été envoyée. Nous vous contacterons dès que possible.",fileNeeded:["**/*Driver Profile Data*.csv","**/*Driver Payments*.csv","**/*Driver Lifetime Trip*.csv","**/*Driver Online Offline.csv"],fileMissing:[],fileRules:[function(e){return!!e||"Fichier requis"},function(e){return e&&e.size<5e8||"Le fichier est trop volumineux"},function(e){return e&&e.name.endsWith(".zip")||"Le fichier doit être un zip"}],paymentURL:null}},computed:{statusIcon:function(){return this.error?"mdiAlert":this.success?"mdiCheckCircle":"mdiUpload"}},watch:{file:function(){this.validated=!1,this.error=!1,this.progress=!1,this.success=!1,this.fileMissing=[],this.paymentURL=null}},methods:{validateZip:function(e){return this.fileMissing=this.fileNeeded.filter((function(t){var r=_.a.makeRe(t);return!e.file(r).length})),0===this.fileMissing.length},getUberInfos:function(e){return Object(f.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.file(_.a.makeRe("**/*Driver Profile Data*.csv"))[0].async("text");case 2:return r=t.sent,t.next=5,y.a(r,(function(e){return{email:e.email,firstname:e.firstname,lastname:e.lastname}}))[0];case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()},uploadFile:function(){var e=this;return Object(f.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,content,d,f,v,h,text,_,y,w,k,R,U,C,L;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.fileForm.validate()){t.next=2;break}return t.abrupt("return");case 2:return e.disabled=!0,e.error=!1,e.progress=!0,e.status="Reading file...",r=new m.a,t.next=9,r.loadAsync(e.file);case 9:if(n=t.sent,e.status="Validating file...",e.error=!e.validateZip(n),!e.error){t.next=17;break}return e.errorMessage="Erreur pendant la validation du fichier: ",e.disabled=!1,e.progress=!1,t.abrupt("return");case 17:return e.status="Getting file name...",t.next=20,Object(x.hashFile)(e.file);case 20:return o=t.sent,c="Uber_".concat(o,".zip"),e.status="Encrypting file...",l=null,t.prev=24,t.next=27,n.generateAsync({type:"uint8array"});case 27:return content=t.sent,t.next=30,Object(x.encryptFile)(content,e.publicKey);case 30:d=t.sent,l=new File([d],c,{type:"application/zip"}),t.next=42;break;case 34:return t.prev=34,t.t0=t.catch(24),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant l'encryption du fichier: "+t.t0.toString(),t.abrupt("return");case 42:return e.status="Getting presigned URL...",f=null,t.prev=44,v=e.s3URL+"getUploadUrl?"+new URLSearchParams({platform:e.platform,country:e.country,name:c}),t.next=48,fetch(v);case 48:if(200===(h=t.sent).status){t.next=54;break}return t.next=52,h.text();case 52:throw text=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(h.status," : ").concat(text));case 54:return t.next=56,h.json();case 56:if(_=t.sent,f=_.presignedUrl){t.next=60;break}throw new Error("No presigned URL returned");case 60:t.next=70;break;case 62:return t.prev=62,t.t1=t.catch(44),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant la récupération du lien d'upload: "+t.t1.toString(),t.abrupt("return");case 70:return e.status="Uploading file...",t.prev=71,t.next=74,e.$axios.put(f,l,{headers:{"Content-Type":"application/zip"},onUploadProgress:function(t){var progress=Math.round(100*t.loaded/t.total);progress<100&&(e.uploadPercentage=progress)}});case 74:if(200===(y=t.sent).status){t.next=80;break}return t.next=78,y.text();case 78:throw w=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(y.status," : ").concat(w));case 80:t.next=90;break;case 82:return t.prev=82,t.t2=t.catch(71),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant l'upload du fichier: "+t.t2.toString(),t.abrupt("return");case 90:return e.status="Creating a transaction...",t.next=93,e.getUberInfos(n);case 93:return k=t.sent,R=k.email,U=k.firstname,C=k.lastname,L=null,t.prev=98,v=e.s3URL+"createTransaction?"+new URLSearchParams({filename:c,email:R,firstname:U,lastname:C}),t.next=102,fetch(v);case 102:if(200===(h=t.sent).status){t.next=108;break}return t.next=106,h.text();case 106:throw text=t.sent,new Error("Le serveur à retourner le code d'erreur ".concat(h.status," : ").concat(text));case 108:return t.next=110,h.json();case 110:if(_=t.sent,L=_.client_reference_id){t.next=114;break}throw new Error("No clientRefID returned");case 114:t.next=124;break;case 116:return t.prev=116,t.t3=t.catch(98),e.error=!0,e.disabled=!1,e.progress=!1,e.status="",e.errorMessage="Erreur pendant la création de la transaction: "+t.t3.toString(),t.abrupt("return");case 124:e.paymentURL="https://buy.stripe.com/fZe8wYbek6Nm6ze4gg?prefilled_email=".concat(R,"&client_reference_id=").concat(L,"&locale=fr"),e.status="",e.success=!0,e.disabled=!1,e.progress=!1;case 129:case"end":return t.stop()}}),t,null,[[24,34],[44,62],[71,82],[98,116]])})))()}}},k=r(50),component=Object(k.a)(w,(function(){var e=this,t=e._self._c;return t(o.a,{staticClass:"pa-6",attrs:{outlined:""}},[t(l.a,{ref:"fileForm"},[t(c.a,{staticClass:"mx-auto",attrs:{disabled:e.disabled,rules:e.fileRules,"show-size":"",label:"Sélectionnez votre archive",accept:"application/zip"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e._v(" "),t("BaseButton",e._b({staticClass:"my-sm-2 mr-sm-4",attrs:{"mdi-icon":e.statusIcon},on:{click:e.uploadFile}},"BaseButton",{disabled:e.disabled,progress:e.progress},!1),[t("span",[e._v("Transmettez vos données")])]),e._v(" "),e.status?t("div",{domProps:{textContent:e._s(e.status)}}):e._e(),e._v(" "),e.error||e.success?t(n.a,{staticClass:"mt-6 text-left",attrs:{type:e.error?"error":"success",text:""}},[e._v("\n      "+e._s(e.error?e.errorMessage:e.successMessage)+"\n      "),e.fileMissing.length?t("p",[e._v("\n        "+e._s(e.fileMissing.length)+" fichiers manquent à votre archive:\n        "),t("ul",e._l(e.fileMissing,(function(r){return t("li",{key:r},[e._v("\n            "+e._s(r)+"\n          ")])})),0),e._v(" "),t("br"),e._v("\n        Avez bien suivi les instructions pour récupérer vos données ?\n        "),t("br"),e._v("\n        Si vous rencontrez des problèmes pour récupérer vos données ou si ce message apparait alors que vous avez récemment récupéré vos données en suivant bien le protocole indiqué sur "),t("a",{attrs:{href:"https://personaldata.io/nos-donnees-nos-projets/mobilite/uber/rgpd/",target:"blank"}},[e._v("cette page")]),e._v(", veuillez nous contacter via "),t("a",{attrs:{href:e.whatsAppLink,target:"blank"}},[e._v("Whatsapp")]),e._v(".\n      ")]):e._e()]):e._e(),e._v(" "),e.success&&e.paymentURL?t("CheckoutDialog",e._b({},"CheckoutDialog",{paymentURL:e.paymentURL},!1)):e._e()],1),e._v(" "),e.progress&&e.uploadPercentage?t("div",{staticClass:"text-center mt-6"},[t(d.a,{attrs:{value:e.uploadPercentage,color:"primary",height:"4"}}),e._v(" "),t("div",[e._v(e._s(e.uploadPercentage)+"%")])],1):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{BaseButton:r(620).default,CheckoutDialog:r(1167).default})}}]);