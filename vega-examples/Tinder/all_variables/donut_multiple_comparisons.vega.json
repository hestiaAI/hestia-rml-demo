{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 400,
  "height": 415,
  "autosize": "fit",
  "title": {
    "text": { "signal": "versus[0] + ' vs ' + versus[1]" },
    "subtitle": {
      "signal": "'between ' + timeFormat(extent[0], \"%d/%m/%Y\") + ' and ' + timeFormat(extent[1], \"%d/%m/%Y\")"
    },
    "dy": { "value": -24 },
    "fontWeight": { "value": "lighter" },
    "fontSize": { "value": 18 },
    "font": { "value": "Tahoma" },
    "color": { "value": "#303030" },
    "subtitleFont": { "value": "Tahoma" },
    "subtitleFontStyle": { "value": "italic" },
    "subtitlePadding": 10,
    "anchor": "middle",
    "frame": "group"
  },
  "signals": [
    {
      "name": "versus",
      "value": ["Likes", "Passes"],
      "bind": {
        "input": "select",
        "name": " ",
        "options": [
          ["Likes", "Passes"],
          ["Likes", "Matches"],
          ["Messages sent", "Messages received"],
          ["Likes", "App opened"]
        ],
        "labels": [
          "Likes/Passes",
          "Likes/Matches",
          "Messages sent/received",
          "Open/Likes"
        ]
      }
    },
    {
      "name": "colors",
      "value": {
        "Likes": "#62D995",
        "Passes": "#d24d57",
        "App opened": "#F2F2F2",
        "Messages sent": "#2994F2",
        "Messages received": "#F2C063",
        "Matches": "#d24d57"
      }
    }
  ],
  "data": [
    {
      "name": "source",
      "values": [],
      "format": { "type": "json", "parse": { "date": "date:'%Y-%m-%d'" } },
      "transform": [
        {
          "type": "extent",
          "field": "date",
          "signal": "extent"
        },
        {
          "type": "aggregate",
          "fields": [
            "like",
            "open",
            "number_of_superlike",
            "pass",
            "number_of_messages_sent",
            "number_of_messages_received",
            "number_of_match"
          ],
          "ops": ["sum", "sum", "sum", "sum", "sum", "sum", "sum"],
          "as": [
            "Likes",
            "App opened",
            "Superlikes",
            "Passes",
            "Messages sent",
            "Messages received",
            "Matches"
          ]
        },
        {
          "type": "fold",
          "fields": { "signal": "versus" }
        },
        {
          "type": "pie",
          "field": "value",
          "sort": true
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "color",
      "type": "ordinal",
      "domain": { "data": "source", "field": "key" },
      "range": ["#FF6A6E", "#414141"]
    }
  ],

  "legends": [
    {
      "orient": "bottom",
      "fill": "color",
      "symbolSize": 120,
      "offset": 0,
      "zindex": 1,
      "symbolType": "circle",
      "labelFont": { "value": "Tahoma" },
      "labelColor": { "value": "#24252a" },
      "labelFontWeight": { "value": "lighter" }
    }
  ],

  "marks": [
    {
      "type": "arc",
      "from": { "data": "source" },
      "encode": {
        "enter": {
          "fill": { "scale": "color", "field": "key" },
          "x": { "signal": "width / 2" },
          "y": { "signal": "height / 2" },
          "tooltip": {
            "signal": "datum.key + ': ' + datum.value"
          }
        },
        "update": {
          "startAngle": { "field": "startAngle" },
          "endAngle": { "field": "endAngle" },
          "padAngle": { "value": 0.02 },
          "innerRadius": { "signal": "width / 20" },
          "outerRadius": { "signal": "width / 2.5" },
          "cornerRadius": { "value": 7 },
          "opacity": { "value": 1 },
          "zindex": { "value": 0 }
        },
        "hover": {
          "opacity": { "value": 0.7 }
        }
      }
    }
  ]
}
