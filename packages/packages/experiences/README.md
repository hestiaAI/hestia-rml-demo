<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->

**Table of Contents**

- [Experience packages](#experience-packages)
  - [Configuration with viewer options](#configuration-with-viewer-options)
  - [All the possible attributes](#all-the-possible-attributes)
- [For developers](#for-developers)
  - [Importing an experience into your code](#importing-an-experience-into-your-code)
  - [Viewer options usage](#viewer-options-usage)
    - [Configuring an experienceModule](#configuring-an-experiencemodule)
    - [Finding viewer options](#finding-viewer-options)
    - [Testing compatibility](#testing-compatibility)
    - [Usage examples](#usage-examples)
      - [Vue project data-experience](#vue-project-data-experience)
      - [Nuxt project experiences](#nuxt-project-experiences)

<!-- markdown-toc end -->

**(This table of contents needs to be updated whenever the content changes. It was generated by an editor's markdown plugin.)**

# Experience packages

These packages define experiences that can be displayed by the component **TheDataExperience** from project [data-experience](../../../data-experience/README.md).

## Configuration with viewer options

An experience can be configured with **viewer options** that can be taken from a json file. When imported, it is already configured by the default _-viewer.json_ file in its _src_ folder, for example [instagram-viewer.json](instagram/src/instagram-viewer.json)

When defining a new configuration, it's best to start from a default configuration and modify it, as a lot of them have experience specific attributes.

## All the possible attributes

The exact type of _ViewerOptions_ and its attributes are defined in the [types folder](../../lib/types)

File [experience-options.ts](../../lib/types/experience-options.ts)

```typescript
export type ViewerOptions = {
  /**
   * The viewblocks that define the different tabs of an experience.
   * See the ViewBlock type further down to see the possible attributes.
   */
  viewBlocks: ViewBlock[]

  /** Monolingual texts.
   * They are meant to be replaced with multilingual texts
   * specified in the messages attribute.
   * However some parts of our code
   * (Probably the ViewBlocks in SectionViewer.vue,
   *  and possibly the list of experiences in _experience/index.vue)
   * don't use messages yet.
   */
  title: string
  subtitle?: string
  dataPortal?: string
  dataPortalHtml?: string
  dataPortalMessage?: string

  /**
   * The translations contain multilingual messages
   * that are specific to the experience.
   * Some of them should override the monolingual attributes above,
   * for example dataPortal would be overridden by
   * messages.en.dataPortal in english and
   * messages.fr.dataPortal in french.
   */
  messages?: Messages

  /** This is the version of the viewer format. It must be >= the viewerVersion of the experience. */
  version?: number

  /** Display options */
  hideEmptyTabs?: boolean
  hideFileExplorer?: boolean
  hideSummary?: boolean

  /** Link to an icon, typically a company logo */
  icon?: string

  /** Array of links to samples of the data to be analyzed in the experience*/
  dataSamples?: string[]
  /** Array of links to videos, on vimeo for example */
  tutorialVideos?: string[]
  /** (Apparently an alternative url for placeholder experiences without real content) */
  url?: string
  /** See the Collaborator type below*/
  collaborator?: Collaborator
}

/**
 * The multilingual messages.
 * A few replace the monolingual messages,
 * but there are also messages specific to
 * the experience, viewblocks and their charts.
 * See the default configuration to have an idea
 * of what texts you can change.
 */
export type Messages = Record<
  Lang,
  {
    viewBlocks: {
      [key: string]: object
    }
    [key: string]: object
  }
>

/**
 * Another organization we're working with, like eyeballs or dating privacy
 */
export type Collaborator = {
  icon: string
  title: string
  url: string
}
```

File [view-block.ts](../../lib/types/view-block.ts)

```typescript
/**
 * The options that configure an experience tab
 */
export type ViewBlock = {
  id: string
  title: string
  text: string
  image?: string
  overlay?: string | boolean
  showTable?: boolean

  /**
   * The following attributes are highly dependent on
   * each other and on the particular experience.
   * You probably don't want to change them.
   */
  files?: string[]
  customPipeline?: string | CustomPipeline
  customPipelineOptions?: CustomPipelineOptions
  postprocessor?: string | PostprocessorFunction
  sql?: string
  visualization?: string | object
  /**
   * This is the configuration for the visualization.
   * In some cases it can be huge, for example when it includes
   * a whole kepler configuration.
   */
  vizProps?: object
}
```

# For developers

## Importing an experience into your code

An experience can be imported from npm in node, as in data-experience's [development example](https://github.com/hestiaAI/hestialabs-experiences/blob/master/data-experience/dev/App.vue#L39)

```javascript
import appleTracker from '@hestia.ai/apple-tracker'
```

or from cdns like jsdelivr.com or unpkg.com in the browser, as in this data-experience deployment example [index.js](https://github.com/hestiaAI/hestialabs-experiences/blob/master/data-experience/deployment-examples/html-plain/index.js#L2)

```javascript
import twitterAgg from 'https://cdn.jsdelivr.net/npm/@hestia.ai/twitter-agg/dist/index.mjs'
```

Then it can be set as a _TheDataExperience_ prop, as in the deployment example's [index.html](https://github.com/hestiaAI/hestialabs-experiences/blob/master/data-experience/deployment-examples/html-plain/index.html#L19)

```vue
<the-data-experience v-bind="{ experienceModule: twitterAgg }" />
```

## Viewer options usage

The experience module has several methods that help configuring an experience.

### Configuring an experienceModule

[configureViewer](https://github.com/hestiaAI/hestialabs-experiences/blob/master/packages/lib/index.ts#L181) creates a new experience module configured with the options passed as argument.

```javascript
const newExperienceModule = experienceModule.configureViewer(viewerOpts)
```

### Finding viewer options

[provideViewerOptions](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c/packages/lib/index.ts#L202) downloads viewer options from an url when given these types of arguments:

- an url prefix that the experienceModule can use to download an experience's viewer.json file like [instagram-viewer.json](https://raw.githubusercontent.com/digipower-academy/experience-viewer-options/main/viewer-options/instagram-viewer.json) from the repo [experience-viewer-options](https://github.com/digipower-academy/experience-viewer-options)
- an object where keys are experience names and values url prefixes

### Testing compatibility

The version of the viewer.json file must be equal or greater than the experiences viewerVersion. _configureViewer_ would throw an exception if the versions are incompatible, but it also has method that returns a string that explains compatibility errors: [viewerCompatibilityErrors](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c9c1c385fb5eece8bffcaced/packages/lib/index.ts#L163).

### Usage examples

#### Vue project data-experience

See directory [data-experience](../../../data-experience).

It's used by component [TheDataExperience.vue](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c/data-experience/src/components/TheDataExperience.vue#L458). Note that the [experienceViewerOptions](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c9c1c385fb5eece8bffcaced/data-experience/src/components/TheDataExperience.vue#L293) are taken from the _siteConfig_ unless they can be found in the _bubbleConfig_.

#### Nuxt project experiences

See directory [experiences](../../../experiences).

Here's how they are used in the _experiences_ nuxt project's [store](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c9c1c385fb5eece8bffcaced/experiences/store/index.js#L178). Note that the _experienceViewerOptions_ are taken from the _siteConfig_ to fetch the viewer.jsons when the store is initialized, and that _siteConfig.experienceViewerOptions_ is then [set to undefined](https://github.com/hestiaAI/hestialabs-experiences/blob/6287e3ac05287d85c9c1c385fb5eece8bffcaced/experiences/store/index.js#L196) to prevent _TheDataExperience.vue_ from fetching them again as described in above, unless it's in a bubble (see previous section about [data-experience](#vue-project-data-experience)).

## Developing an experience

See the [packages project's README](../../README.md)
